@inject NavigationManager Navigation
@inject Blazored.LocalStorage.ILocalStorageService LocalStorage 

<EditForm Model="@_model" OnValidSubmit="@OnValidSubmitAsync">
    <DataAnnotationsValidator/>

    <div class="mb">
        <InputNumber
            @bind-Value="_model.Height"
            class="form-input"
            type="number"
            step="0.01"
            placeholder="Altura"/>
        <span class="form-input-invalid">
            <ValidationMessage For="@(()=>_model.Height)"/>
        </span>
    </div>

    <div class="mb">
        <InputNumber @bind-Value="_model.Weight" class="form-input" type="number" step="0.1" placeholder="Peso" />
        <span class="form-input-invalid">
            <ValidationMessage For="@(() => _model.Weight)" />
        </span>
    </div>
    <div class="flex flex-center">
        <button type="submit" class="btn btn-filled mb">
            Calcular meu IMC
        </button>
        <a class="btn btn-link" href="#about">
            Entenda o Calculo
        </a>
    </div>

</EditForm>

<Dialog @ref="_dialog" OnModalCloseCallBack="@OnModalClose">
    @if(_model.Imc < 18.6)
    {
        <h1>Abaixo do peso</h1>
        <p>Voce esta abaixo do peso recomendado.</p>
    }else if(_model.Imc >= 18.6 && _model.Imc<=24.9)
    {
        <h1>Peso Ideal</h1>
        <p>Parabens!</p>
    }else if(_model.Imc >= 24.9)
    {
        <h1>Sobrepeso</h1>
        <p>Acima do peso recomendado.</p>
    }
</Dialog>

    @code {
    private Dialog _dialog = null!;
    private ImcModel _model = new();

    public async Task OnValidSubmitAsync()
    {

        await ShowModalAsync();
    }
    
    private Task ShowModalAsync() => _dialog.ShowModalAsync();

    private async Task OnModalClose()
    {
        AppState.History.Add(_model);
        await LocalStorage.SetItemAsync("data", AppState.History);
        AppState.NotifyChange(_model, EventArgs.Empty);
        _model = new();

        Navigation.NavigateTo("#history");

    }

}
